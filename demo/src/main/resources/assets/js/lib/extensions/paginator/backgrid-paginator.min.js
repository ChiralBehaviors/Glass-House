/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong
  Licensed under the MIT @license.
*/
(function(e,a,t,s){"use strict";s.Extension.Paginator=s.Footer.extend({className:"paginator",windowSize:10,fastForwardHandleLabels:{first:"《",prev:"〈",next:"〉",last:"》"},template:a.template('<tr><td colspan="<%= colspan %>"><ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul></td></tr>'),events:{"click a":"changePage"},initialize:function(e){var t=this;s.Footer.prototype.initialize.call(t,e),t.listenTo(t.collection,"reset",t.render);var i=t.columns;t.listenTo(i,"add",function(e,s,i){if(i=a.defaults(i||{},{render:!0}),e.get("renderable")&&i.render){var l=t.$el.find("td[colspan]");l.prop("colspan",l.prop("colspan")+1)}}),t.listenTo(i,"remove",function(){var e=t.$el.find("td[colspan]");e.prop("colspan",e.prop("colspan")-1)})},changePage:function(a){a.preventDefault();var t=e(a.target).text(),s=this.fastForwardHandleLabels,i=this.collection;if(s)switch(t){case s.first:return i.getFirstPage(),void 0;case s.prev:return i.hasPrevious()&&i.getPreviousPage(),void 0;case s.next:return i.hasNext()&&i.getNextPage(),void 0;case s.last:return i.getLastPage(),void 0}var l=1*e(a.target).text()-i.state.firstPage,n=i.state,r=0===n.firstPage?n.currentPage:n.currentPage-1,o=Math.floor(r/this.windowSize)*this.windowSize,d=o+l;i.getPage(0===n.firstPage?d:d+1)},makeHandles:function(){var e=[],a=this.collection,t=a.state,s=0===t.firstPage?t.lastPage:t.lastPage-1,i=0===t.firstPage?t.currentPage:t.currentPage-1,l=Math.floor(i/this.windowSize)*this.windowSize,n=l+this.windowSize;if(n=s>=n?n:s+1,"infinite"!==a.mode)for(var r=l;n>r;r++)e.push({label:r+1,title:"No. "+(r+1),className:i===r?"active":void 0});var o=this.fastForwardHandleLabels;return o&&(o.prev&&e.unshift({label:o.prev,className:a.hasPrevious()?void 0:"disabled"}),o.first&&e.unshift({label:o.first,className:a.hasPrevious()?void 0:"disabled"}),o.next&&e.push({label:o.next,className:a.hasNext()?void 0:"disabled"}),o.last&&e.push({label:o.last,className:a.hasNext()?void 0:"disabled"})),e},render:function(){this.$el.empty();var t=a.reduce(this.columns.pluck("renderable"),function(e,a){return a?e+1:0},0);return this.$el.append(e(this.template({colspan:t,handles:this.makeHandles()}))),this}})})(jQuery,_,Backbone,Backgrid);